# Nox - Project Planning Document

## ğŸ¯ Project Vision
Nox is a modern SaaS platform with a subscription-based model, providing users with a seamless experience from landing page to service usage through an intuitive dashboard and robust authentication system.

## Architecture

### Frontend (use Context7 MCP Server)
- **Framework**: Next.js 15.3.2 with App Router
- **Language**: TypeScript 5
- **UI Library**: Shadcn UI (with Radix UI components)
- **State Management**: Redux Toolkit & React Redux
- **Form Handling**: React Hook Form
- **Form Validation**: Zod
- **Animation**: Framer Motion
- **Styling**: TailwindCSS 4
- **Theme**: next-themes
- **Icons**: Lucide React
- **Utility CSS**: clsx, tailwind-merge, class-variance-authority
- **Notifications**: Sonner
- **Date Handling**: date-fns

### Backend (use Context7 MCP Server)
- **Server**: Next.js API Routes
- **Database**: Supabase
- **Authentication**: Supabase Auth
- **Payment Gateway**: Razorpay
- **Encryption**: crypto-js

### Payment Processing
- **Razorpay SDK** - For payment processing
- **Supabase** - For storing subscription information

### Testing
- **Jest** - For unit testing
- **Cypress** - For E2E testing
- **React Testing Library** - For component testing

### DevOps
- **GitHub** - For version control
- **Docker** - For containerization and deployment

## Database Schema

### Core Tables

#### 1. users
- `id` (primary key, UUID) - Auto-generated by Supabase Auth
- `email` (string) - User's email address
- `created_at` (timestamp)
- `updated_at` (timestamp)
- `full_name` (string)
- `avatar_url` (string, nullable)
- `billing_address` (jsonb, nullable)
- `phone_number` (string, nullable)
- `onboarding_completed` (boolean, default: false)

#### 2. subscription_plans
- `id` (primary key, UUID)
- `name` (string) - "Basic", "Pro", "Enterprise"
- `interval` (string) - "weekly", "monthly", "yearly"
- `price` (integer) - Amount in paise/cents
- `description` (text)
- `features` (jsonb) - List of features included
- `active` (boolean) - Whether plan is currently offered
- `created_at` (timestamp)
- `updated_at` (timestamp)

#### 3. subscriptions
- `id` (primary key, UUID)
- `user_id` (UUID, foreign key to users.id)
- `plan_id` (UUID, foreign key to subscription_plans.id)
- `status` (string) - "active", "past_due", "cancelled", "trialing"
- `current_period_start` (timestamp)
- `current_period_end` (timestamp)
- `cancel_at_period_end` (boolean)
- `created_at` (timestamp)
- `updated_at` (timestamp)
- `metadata` (jsonb, nullable)

#### 4. payments
- `id` (primary key, UUID)
- `user_id` (UUID, foreign key to users.id)
- `subscription_id` (UUID, foreign key to subscriptions.id)
- `razorpay_payment_id` (string)
- `razorpay_order_id` (string)
- `razorpay_signature` (string, nullable)
- `amount` (integer) - Amount in paise/cents
- `currency` (string) - "INR"
- `status` (string) - "created", "authorized", "captured", "refunded", "failed"
- `created_at` (timestamp)
- `updated_at` (timestamp)
- `receipt_url` (string, nullable)
- `metadata` (jsonb, nullable)

#### 5. invoices
- `id` (primary key, UUID)
- `user_id` (UUID, foreign key to users.id)
- `subscription_id` (UUID, foreign key to subscriptions.id)
- `payment_id` (UUID, foreign key to payments.id, nullable)
- `status` (string) - "draft", "open", "paid", "uncollectible", "void"
- `amount_due` (integer) - Amount in paise/cents
- `amount_paid` (integer) - Amount in paise/cents
- `invoice_number` (string)
- `invoice_date` (timestamp)
- `due_date` (timestamp)
- `created_at` (timestamp)
- `updated_at` (timestamp)

### Database Relationships
- `subscriptions.user_id` references `users.id`
- `subscriptions.plan_id` references `subscription_plans.id`
- `payments.user_id` references `users.id`
- `payments.subscription_id` references `subscriptions.id`
- `invoices.user_id` references `users.id`
- `invoices.subscription_id` references `subscriptions.id`
- `invoices.payment_id` references `payments.id`

### Row Level Security Policies
- Users can only read and update their own user record
- Users can only read their own subscriptions, payments, and invoices
- Subscription plans are readable by all authenticated users
- Only server-side functions can create/update payments and invoices

## ğŸ›¢ï¸ Database Setup & Reliability

### Schema Implementation
- Tables created with proper relationships
- Foreign key constraints for data integrity
- Row Level Security (RLS) policies for data protection
- Automatic profile creation trigger for new users
- Updated_at trigger for database record tracking

### Database Reliability Features
- Quick-fix SQL script for common database errors
- Comprehensive database setup instructions
- Step-by-step troubleshooting guides
- Dashboard diagnostic tools for database issues
- Robust error handling in database operations
- SQL scripts for initial setup and repair
- Conditional table creation to prevent errors
- Multiple setup options (SQL Editor or Node.js script)
- Row Level Security (RLS) policy debugging and automated fixes
- SQL functions for database administration and RLS management
- RLS policy documentation and troubleshooting guide

### Database Debugging
- Table existence verification
- Relationship testing between tables
- Record count display
- Error message reporting
- User profile creation helper
- Comprehensive console logging
- RLS policy inspection and diagnostics
- Interactive debugging panel for payment and database issues
- Automatic RLS policy correction tools

## File Structure
```
/
â”œâ”€â”€ .next/                # Next.js build output
â”œâ”€â”€ .git/                 # Git repository
â”œâ”€â”€ .cursor/              # Cursor IDE configuration
â”œâ”€â”€ .cursorignore         # Cursor IDE ignore file
â”œâ”€â”€ public/               # Static assets
â”‚   â”œâ”€â”€ file.svg          # File icon SVG
â”‚   â”œâ”€â”€ globe.svg         # Globe icon SVG
â”‚   â”œâ”€â”€ next.svg          # Next.js logo SVG
â”‚   â”œâ”€â”€ vercel.svg        # Vercel logo SVG
â”‚   â””â”€â”€ window.svg        # Window icon SVG
â”œâ”€â”€ src/                  # Source code
â”‚   â”œâ”€â”€ app/              # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ admin/        # Admin panels
â”‚   â”‚   â”œâ”€â”€ api/          # API endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/    # Admin API routes
â”‚   â”‚   â”‚   â”œâ”€â”€ database/ # Database API routes
â”‚   â”‚   â”‚   â”œâ”€â”€ payments/ # Payment API routes
â”‚   â”‚   â”‚   â””â”€â”€ subscription-plans/ # Subscription plan API routes
â”‚   â”‚   â”œâ”€â”€ auth/         # Authentication pages
â”‚   â”‚   â”‚   â”œâ”€â”€ login/    # Login page
â”‚   â”‚   â”‚   â”œâ”€â”€ signup/   # Signup page
â”‚   â”‚   â”‚   â”œâ”€â”€ reset-password/ # Password reset page
â”‚   â”‚   â”‚   â”œâ”€â”€ update-password/ # Password update page
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx # Auth layout
â”‚   â”‚   â”œâ”€â”€ checkout/     # Checkout pages
â”‚   â”‚   â”œâ”€â”€ dashboard/    # Dashboard interface
â”‚   â”‚   â”‚   â”œâ”€â”€ account/  # Account management
â”‚   â”‚   â”‚   â”œâ”€â”€ billing/  # Billing management
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/ # User settings
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx # Dashboard layout
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx  # Dashboard main page
â”‚   â”‚   â”œâ”€â”€ hero-demo/    # Hero demonstration
â”‚   â”‚   â”œâ”€â”€ onboarding/   # User onboarding
â”‚   â”‚   â”œâ”€â”€ pricing/      # Subscription plans
â”‚   â”‚   â”œâ”€â”€ test/         # Test pages
â”‚   â”‚   â”œâ”€â”€ simple-test/  # Simple test pages
â”‚   â”‚   â”œâ”€â”€ fix-test/     # Fix test pages
â”‚   â”‚   â”œâ”€â”€ favicon.ico   # Site favicon
â”‚   â”‚   â”œâ”€â”€ globals.css   # Global CSS
â”‚   â”‚   â”œâ”€â”€ layout.tsx    # Root layout
â”‚   â”‚   â””â”€â”€ page.tsx      # Landing page
â”‚   â”œâ”€â”€ components/       # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ blocks/       # Block components
â”‚   â”‚   â”œâ”€â”€ features/     # Feature-specific components
â”‚   â”‚   â”œâ”€â”€ notifications/# Notification components
â”‚   â”‚   â”œâ”€â”€ pricing/      # Pricing components
â”‚   â”‚   â”œâ”€â”€ shared/       # Shared components
â”‚   â”‚   â”œâ”€â”€ theme/        # Theme components
â”‚   â”‚   â””â”€â”€ ui/           # Shadcn UI components
â”‚   â”‚       â”œâ”€â”€ avatar.tsx        # Avatar component
â”‚   â”‚       â”œâ”€â”€ badge.tsx         # Badge component
â”‚   â”‚       â”œâ”€â”€ button.tsx        # Button component
â”‚   â”‚       â”œâ”€â”€ card.tsx          # Card component
â”‚   â”‚       â”œâ”€â”€ dialog.tsx        # Dialog component
â”‚   â”‚       â”œâ”€â”€ dropdown-menu.tsx # Dropdown menu component
â”‚   â”‚       â”œâ”€â”€ form.tsx          # Form component
â”‚   â”‚       â”œâ”€â”€ input.tsx         # Input component
â”‚   â”‚       â”œâ”€â”€ label.tsx         # Label component
â”‚   â”‚       â”œâ”€â”€ popover.tsx       # Popover component
â”‚   â”‚       â”œâ”€â”€ progress.tsx      # Progress component
â”‚   â”‚       â”œâ”€â”€ separator.tsx     # Separator component
â”‚   â”‚       â”œâ”€â”€ skeleton.tsx      # Skeleton component
â”‚   â”‚       â”œâ”€â”€ sonner.tsx        # Sonner component
â”‚   â”‚       â”œâ”€â”€ switch.tsx        # Switch component
â”‚   â”‚       â”œâ”€â”€ table.tsx         # Table component
â”‚   â”‚       â”œâ”€â”€ tabs.tsx          # Tabs component
â”‚   â”‚       â””â”€â”€ tooltip.tsx       # Tooltip component
â”‚   â”œâ”€â”€ config/           # Configuration files
â”‚   â”‚   â””â”€â”€ subscriptions.ts # Subscription configuration
â”‚   â”œâ”€â”€ lib/              # Utility functions
â”‚   â”‚   â”œâ”€â”€ razorpay/     # Razorpay integration
â”‚   â”‚   â”œâ”€â”€ redux/        # Redux state management
â”‚   â”‚   â”œâ”€â”€ supabase/     # Supabase client setup
â”‚   â”‚   â”œâ”€â”€ validations/  # Form validations
â”‚   â”‚   â”œâ”€â”€ razorpay.ts   # Razorpay utility functions
â”‚   â”‚   â””â”€â”€ utils.ts      # General utilities
â”‚   â”œâ”€â”€ scripts/          # Script files
â”‚   â”œâ”€â”€ types/            # TypeScript type definitions
â”‚   â”‚   â”œâ”€â”€ razorpay.d.ts # Razorpay type definitions
â”‚   â”‚   â””â”€â”€ subscription.ts # Subscription type definitions
â”‚   â”œâ”€â”€ utils/            # Helper functions
â”‚   â”‚   â”œâ”€â”€ auth-error-handler.ts # Authentication error handling
â”‚   â”‚   â””â”€â”€ format-utils.ts      # Formatting utilities
â”‚   â”œâ”€â”€ env-schema.txt    # Environment schema reference
â”‚   â””â”€â”€ middleware.ts     # Next.js middleware
â”œâ”€â”€ components.json       # Shadcn UI components config
â”œâ”€â”€ DEBUG.md              # Debug tracking document
â”œâ”€â”€ eslint.config.mjs     # ESLint configuration
â”œâ”€â”€ next-env.d.ts         # Next.js TypeScript declarations
â”œâ”€â”€ next.config.ts        # Next.js configuration
â”œâ”€â”€ package-lock.json     # NPM package lock
â”œâ”€â”€ package.json          # Project dependencies
â”œâ”€â”€ PLANNING.md           # Project planning document
â”œâ”€â”€ postcss.config.mjs    # PostCSS configuration
â”œâ”€â”€ README.md             # Project README
â”œâ”€â”€ TASK.md               # Task tracking document
â””â”€â”€ tsconfig.json         # TypeScript configuration
```

## ğŸ¨ Design Guidelines

### Theme
- **Dark Theme Only** - The application will exclusively use a dark theme for all UI elements

### Color Palette
- Primary: #00c573 (Accent Green)
- Background: #121212 (Dark Gray)
- Background Secondary: #1e1e1e (Slightly Lighter Gray)
- Text Primary: #ffffff (White)
- Text Secondary: #a1a1aa (Light Gray)
- Success: #10b981 (Green)
- Warning: #f59e0b (Amber)
- Error: #ef4444 (Red)

### Typography
- Headings: Default system font
- Body: Default system font
- UI Components: Shadcn UI defaults

### Design System
- Follow Mobile first approach
- Make UI More Responsive and Clutter free (Neat and Clean)
- Consistent spacing (4px increments)
- Rounded corners (0.5rem for cards, 0.25rem for buttons)
- Subtle shadows for depth
- Consistent button styles across the application
- Dark theme optimized for reduced eye strain
- Green accent color (#00c573) used for CTAs, highlights, and interactive elements

## .env Setup
- NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
- NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
- NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
- NEXT_PUBLIC_APP_URL=your-production-url
- NEXT_PUBLIC_RAZORPAY_KEY_ID=your-razorpay-key-id
- NEXT_PUBLIC_RAZORPAY_KEY_SECRET=your-razorpay-key-secret
- NEXT_PUBLIC_RAZORPAY_WEBHOOK_SECRET=your-razorpay-webhook-secret
- REDIS_URL=your-redis-url (optional)
- REDIS_TOKEN=your-redis-token (optional)

## ğŸ” Security Considerations
- Implement proper authentication with Supabase
- Use HTTPS for all communications
- Store sensitive data in environment variables
- Implement backend verification for payment signatures
- Regular security audits
- CSRF protection via Next.js API routes
- XSS prevention
- Input validation on all forms with Zod
- Row Level Security for database tables

## ğŸš€ Deployment Strategy
- **Docker Containerization** - Primary deployment method
  - Multi-stage build for optimized image size
  - Docker Compose for local development
  - Production-ready Dockerfile
- Development environment: Docker containers with local development
- Staging environment: Docker containers with production-like configuration
- Production environment: Docker containers deployed to cloud provider
- CI/CD pipeline through GitHub Actions with automated Docker image builds
- Database migrations managed through Supabase

## ğŸ“ Coding Standards
- Use TypeScript for type safety
- Follow ESLint rules
- Use Prettier for code formatting
- Write unit tests for critical functionality
- Document complex logic with comments
- Use meaningful variable and function names
- Keep functions small and focused
- Keep files under 500 lines of code
- Follow the DRY principle (Don't Repeat Yourself)

## ğŸ“ˆ Performance Goals
- Page load time under 2 seconds
- First Contentful Paint under 1 second
- Time to Interactive under 3 seconds
- Optimize assets for fast loading
- Implement code splitting
- Use Next.js Image component for optimized images
- Implement caching strategies
- Pagination for large data sets

## ğŸ§© Third-Party Integrations
- Supabase for authentication and database
- Razorpay for payment processing
- Google Analytics for tracking

## Implementation Phases

### Phase 1: Project Setup and Foundation
- Initialize Next.js with TypeScript
- Configure TailwindCSS and Shadcn UI
- Set up Supabase client
- Create base layouts and navigation

### Phase 2: Authentication System
- Implement Supabase authentication
- Create login/signup pages with validation
- Set up protected routes and middleware
- Design user profile management

### Phase 3: Subscription and Payment System
- Define subscription tiers (Weekly, Monthly, Yearly)
- Implement Razorpay integration
- Create subscription management logic
- Build pricing page with tier comparison

### Phase 4: Dashboard and Core Features
- Design main dashboard UI
- Implement subscription management interface
- Create user settings and profile page
- Add feature-specific sections based on subscription tier

### Phase 5: UI/UX Enhancement
- Add animations with Framer Motion
- Implement dark/light mode
- Create responsive layouts for all device sizes
- Add loading states and skeletons

### Phase 6: Testing, Optimization, and Launch
- Implement error handling
- Optimize performance and loading times
- Test all user flows
- Prepare for deployment

## Constraints and Guidelines
- Max file size: 500 lines of code
- Modular component architecture
- Consistent naming conventions
- Mobile-first responsive design
- Accessible UI elements
- Proper error handling

## Tools and References
- Supabase Documentation
- Razorpay API Documentation
- Shadcn UI Documentation
- Framer Motion Examples
- Context7 for updated docs and references 