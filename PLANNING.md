# Nox - Project Planning Document

## 🎯 Project Vision
Nox is a modern SaaS platform with a subscription-based model, providing users with a seamless experience from landing page to service usage through an intuitive dashboard and robust authentication system.

## Architecture

### Frontend (use Context7 MCP Server)
- **Framework**: Next.js 15.3.2 with App Router
- **Language**: TypeScript 5
- **UI Library**: Shadcn UI (with Radix UI components)
- **State Management**: Redux Toolkit & React Redux
- **Form Handling**: React Hook Form
- **Form Validation**: Zod
- **Animation**: Framer Motion
- **Styling**: TailwindCSS 4
- **Theme**: next-themes
- **Icons**: Lucide React
- **Utility CSS**: clsx, tailwind-merge, class-variance-authority
- **Notifications**: Sonner
- **Date Handling**: date-fns

### Backend (use Context7 MCP Server)
- **Server**: Next.js API Routes
- **Database**: Supabase
- **Authentication**: Supabase Auth
- **Payment Gateway**: Razorpay
- **Encryption**: crypto-js

### Payment Processing
- **Razorpay SDK** - For payment processing
- **Supabase** - For storing subscription information

### Testing
- **Jest** - For unit testing
- **Cypress** - For E2E testing
- **React Testing Library** - For component testing

### DevOps
- **GitHub** - For version control
- **Docker** - For containerization and deployment

## Database Schema

### Core Tables

#### 1. users
- `id` (primary key, UUID) - Auto-generated by Supabase Auth
- `email` (string) - User's email address
- `created_at` (timestamp)
- `updated_at` (timestamp)
- `full_name` (string)
- `avatar_url` (string, nullable)
- `billing_address` (jsonb, nullable)
- `phone_number` (string, nullable)
- `onboarding_completed` (boolean, default: false)

#### 2. subscription_plans
- `id` (primary key, UUID)
- `name` (string) - "Basic", "Pro", "Enterprise"
- `interval` (string) - "weekly", "monthly", "yearly"
- `price` (integer) - Amount in paise/cents
- `description` (text)
- `features` (jsonb) - List of features included
- `active` (boolean) - Whether plan is currently offered
- `created_at` (timestamp)
- `updated_at` (timestamp)

#### 3. subscriptions
- `id` (primary key, UUID)
- `user_id` (UUID, foreign key to users.id)
- `plan_id` (UUID, foreign key to subscription_plans.id)
- `status` (string) - "active", "past_due", "cancelled", "trialing"
- `current_period_start` (timestamp)
- `current_period_end` (timestamp)
- `cancel_at_period_end` (boolean)
- `created_at` (timestamp)
- `updated_at` (timestamp)
- `metadata` (jsonb, nullable)

#### 4. payments
- `id` (primary key, UUID)
- `user_id` (UUID, foreign key to users.id)
- `subscription_id` (UUID, foreign key to subscriptions.id)
- `razorpay_payment_id` (string)
- `razorpay_order_id` (string)
- `razorpay_signature` (string, nullable)
- `amount` (integer) - Amount in paise/cents
- `currency` (string) - "INR"
- `status` (string) - "created", "authorized", "captured", "refunded", "failed"
- `created_at` (timestamp)
- `updated_at` (timestamp)
- `receipt_url` (string, nullable)
- `metadata` (jsonb, nullable)

#### 5. invoices
- `id` (primary key, UUID)
- `user_id` (UUID, foreign key to users.id)
- `subscription_id` (UUID, foreign key to subscriptions.id)
- `payment_id` (UUID, foreign key to payments.id, nullable)
- `status` (string) - "draft", "open", "paid", "uncollectible", "void"
- `amount_due` (integer) - Amount in paise/cents
- `amount_paid` (integer) - Amount in paise/cents
- `invoice_number` (string)
- `invoice_date` (timestamp)
- `due_date` (timestamp)
- `created_at` (timestamp)
- `updated_at` (timestamp)

### Database Relationships
- `subscriptions.user_id` references `users.id`
- `subscriptions.plan_id` references `subscription_plans.id`
- `payments.user_id` references `users.id`
- `payments.subscription_id` references `subscriptions.id`
- `invoices.user_id` references `users.id`
- `invoices.subscription_id` references `subscriptions.id`
- `invoices.payment_id` references `payments.id`

### Row Level Security Policies
- Users can only read and update their own user record
- Users can only read their own subscriptions, payments, and invoices
- Subscription plans are readable by all authenticated users
- Only server-side functions can create/update payments and invoices

## 🛢️ Database Setup & Reliability

### Schema Implementation
- Tables created with proper relationships
- Foreign key constraints for data integrity
- Row Level Security (RLS) policies for data protection
- Automatic profile creation trigger for new users
- Updated_at trigger for database record tracking

### Database Reliability Features
- Quick-fix SQL script for common database errors
- Comprehensive database setup instructions
- Step-by-step troubleshooting guides
- Dashboard diagnostic tools for database issues
- Robust error handling in database operations
- SQL scripts for initial setup and repair
- Conditional table creation to prevent errors
- Multiple setup options (SQL Editor or Node.js script)
- Row Level Security (RLS) policy debugging and automated fixes
- SQL functions for database administration and RLS management
- RLS policy documentation and troubleshooting guide

### Database Debugging
- Table existence verification
- Relationship testing between tables
- Record count display
- Error message reporting
- User profile creation helper
- Comprehensive console logging
- RLS policy inspection and diagnostics
- Interactive debugging panel for payment and database issues
- Automatic RLS policy correction tools

## File Structure
```
/
├── .next/                # Next.js build output
├── .git/                 # Git repository
├── .cursor/              # Cursor IDE configuration
├── .cursorignore         # Cursor IDE ignore file
├── public/               # Static assets
│   ├── file.svg          # File icon SVG
│   ├── globe.svg         # Globe icon SVG
│   ├── next.svg          # Next.js logo SVG
│   ├── vercel.svg        # Vercel logo SVG
│   └── window.svg        # Window icon SVG
├── src/                  # Source code
│   ├── app/              # Next.js App Router
│   │   ├── admin/        # Admin panels
│   │   ├── api/          # API endpoints
│   │   │   ├── admin/    # Admin API routes
│   │   │   ├── database/ # Database API routes
│   │   │   ├── payments/ # Payment API routes
│   │   │   └── subscription-plans/ # Subscription plan API routes
│   │   ├── auth/         # Authentication pages
│   │   │   ├── login/    # Login page
│   │   │   ├── signup/   # Signup page
│   │   │   ├── reset-password/ # Password reset page
│   │   │   ├── update-password/ # Password update page
│   │   │   └── layout.tsx # Auth layout
│   │   ├── checkout/     # Checkout pages
│   │   ├── dashboard/    # Dashboard interface
│   │   │   ├── account/  # Account management
│   │   │   ├── billing/  # Billing management
│   │   │   ├── settings/ # User settings
│   │   │   ├── layout.tsx # Dashboard layout
│   │   │   └── page.tsx  # Dashboard main page
│   │   ├── hero-demo/    # Hero demonstration
│   │   ├── onboarding/   # User onboarding
│   │   ├── pricing/      # Subscription plans
│   │   ├── test/         # Test pages
│   │   ├── simple-test/  # Simple test pages
│   │   ├── fix-test/     # Fix test pages
│   │   ├── favicon.ico   # Site favicon
│   │   ├── globals.css   # Global CSS
│   │   ├── layout.tsx    # Root layout
│   │   └── page.tsx      # Landing page
│   ├── components/       # Reusable UI components
│   │   ├── blocks/       # Block components
│   │   ├── features/     # Feature-specific components
│   │   ├── notifications/# Notification components
│   │   ├── pricing/      # Pricing components
│   │   ├── shared/       # Shared components
│   │   ├── theme/        # Theme components
│   │   └── ui/           # Shadcn UI components
│   │       ├── avatar.tsx        # Avatar component
│   │       ├── badge.tsx         # Badge component
│   │       ├── button.tsx        # Button component
│   │       ├── card.tsx          # Card component
│   │       ├── dialog.tsx        # Dialog component
│   │       ├── dropdown-menu.tsx # Dropdown menu component
│   │       ├── form.tsx          # Form component
│   │       ├── input.tsx         # Input component
│   │       ├── label.tsx         # Label component
│   │       ├── popover.tsx       # Popover component
│   │       ├── progress.tsx      # Progress component
│   │       ├── separator.tsx     # Separator component
│   │       ├── skeleton.tsx      # Skeleton component
│   │       ├── sonner.tsx        # Sonner component
│   │       ├── switch.tsx        # Switch component
│   │       ├── table.tsx         # Table component
│   │       ├── tabs.tsx          # Tabs component
│   │       └── tooltip.tsx       # Tooltip component
│   ├── config/           # Configuration files
│   │   └── subscriptions.ts # Subscription configuration
│   ├── lib/              # Utility functions
│   │   ├── razorpay/     # Razorpay integration
│   │   ├── redux/        # Redux state management
│   │   ├── supabase/     # Supabase client setup
│   │   ├── validations/  # Form validations
│   │   ├── razorpay.ts   # Razorpay utility functions
│   │   └── utils.ts      # General utilities
│   ├── scripts/          # Script files
│   ├── types/            # TypeScript type definitions
│   │   ├── razorpay.d.ts # Razorpay type definitions
│   │   └── subscription.ts # Subscription type definitions
│   ├── utils/            # Helper functions
│   │   ├── auth-error-handler.ts # Authentication error handling
│   │   └── format-utils.ts      # Formatting utilities
│   ├── env-schema.txt    # Environment schema reference
│   └── middleware.ts     # Next.js middleware
├── components.json       # Shadcn UI components config
├── DEBUG.md              # Debug tracking document
├── eslint.config.mjs     # ESLint configuration
├── next-env.d.ts         # Next.js TypeScript declarations
├── next.config.ts        # Next.js configuration
├── package-lock.json     # NPM package lock
├── package.json          # Project dependencies
├── PLANNING.md           # Project planning document
├── postcss.config.mjs    # PostCSS configuration
├── README.md             # Project README
├── TASK.md               # Task tracking document
└── tsconfig.json         # TypeScript configuration
```

## 🎨 Design Guidelines

### Theme
- **Dark Theme Only** - The application will exclusively use a dark theme for all UI elements

### Color Palette
- Primary: #00c573 (Accent Green)
- Background: #121212 (Dark Gray)
- Background Secondary: #1e1e1e (Slightly Lighter Gray)
- Text Primary: #ffffff (White)
- Text Secondary: #a1a1aa (Light Gray)
- Success: #10b981 (Green)
- Warning: #f59e0b (Amber)
- Error: #ef4444 (Red)

### Typography
- Headings: Default system font
- Body: Default system font
- UI Components: Shadcn UI defaults

### Design System
- Follow Mobile first approach
- Make UI More Responsive and Clutter free (Neat and Clean)
- Consistent spacing (4px increments)
- Rounded corners (0.5rem for cards, 0.25rem for buttons)
- Subtle shadows for depth
- Consistent button styles across the application
- Dark theme optimized for reduced eye strain
- Green accent color (#00c573) used for CTAs, highlights, and interactive elements

## .env Setup
- NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
- NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
- NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
- NEXT_PUBLIC_APP_URL=your-production-url
- NEXT_PUBLIC_RAZORPAY_KEY_ID=your-razorpay-key-id
- NEXT_PUBLIC_RAZORPAY_KEY_SECRET=your-razorpay-key-secret
- NEXT_PUBLIC_RAZORPAY_WEBHOOK_SECRET=your-razorpay-webhook-secret
- REDIS_URL=your-redis-url (optional)
- REDIS_TOKEN=your-redis-token (optional)

## 🔐 Security Considerations
- Implement proper authentication with Supabase
- Use HTTPS for all communications
- Store sensitive data in environment variables
- Implement backend verification for payment signatures
- Regular security audits
- CSRF protection via Next.js API routes
- XSS prevention
- Input validation on all forms with Zod
- Row Level Security for database tables

## 🚀 Deployment Strategy
- **Docker Containerization** - Primary deployment method
  - Multi-stage build for optimized image size
  - Docker Compose for local development
  - Production-ready Dockerfile
- Development environment: Docker containers with local development
- Staging environment: Docker containers with production-like configuration
- Production environment: Docker containers deployed to cloud provider
- CI/CD pipeline through GitHub Actions with automated Docker image builds
- Database migrations managed through Supabase

## 📏 Coding Standards
- Use TypeScript for type safety
- Follow ESLint rules
- Use Prettier for code formatting
- Write unit tests for critical functionality
- Document complex logic with comments
- Use meaningful variable and function names
- Keep functions small and focused
- Keep files under 500 lines of code
- Follow the DRY principle (Don't Repeat Yourself)

## 📈 Performance Goals
- Page load time under 2 seconds
- First Contentful Paint under 1 second
- Time to Interactive under 3 seconds
- Optimize assets for fast loading
- Implement code splitting
- Use Next.js Image component for optimized images
- Implement caching strategies
- Pagination for large data sets

## 🧩 Third-Party Integrations
- Supabase for authentication and database
- Razorpay for payment processing
- Google Analytics for tracking

## Implementation Phases

### Phase 1: Project Setup and Foundation
- Initialize Next.js with TypeScript
- Configure TailwindCSS and Shadcn UI
- Set up Supabase client
- Create base layouts and navigation

### Phase 2: Authentication System
- Implement Supabase authentication
- Create login/signup pages with validation
- Set up protected routes and middleware
- Design user profile management

### Phase 3: Subscription and Payment System
- Define subscription tiers (Weekly, Monthly, Yearly)
- Implement Razorpay integration
- Create subscription management logic
- Build pricing page with tier comparison

### Phase 4: Dashboard and Core Features
- Design main dashboard UI
- Implement subscription management interface
- Create user settings and profile page
- Add feature-specific sections based on subscription tier

### Phase 5: UI/UX Enhancement
- Add animations with Framer Motion
- Implement dark/light mode
- Create responsive layouts for all device sizes
- Add loading states and skeletons

### Phase 6: Testing, Optimization, and Launch
- Implement error handling
- Optimize performance and loading times
- Test all user flows
- Prepare for deployment

## Constraints and Guidelines
- Max file size: 500 lines of code
- Modular component architecture
- Consistent naming conventions
- Mobile-first responsive design
- Accessible UI elements
- Proper error handling

## Tools and References
- Supabase Documentation
- Razorpay API Documentation
- Shadcn UI Documentation
- Framer Motion Examples
- Context7 for updated docs and references 